<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0e1a">
<meta name="description" content="Match-3 puzzle game set in Azeroth with rhythm combat, weather systems, and smart hints.">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='32' fill='%230a0e1a'/><text x='90' y='115' font-size='90' text-anchor='middle'>⚔️</text></svg>">
<title>⚔️ 艾泽拉斯消消乐 — Azeroth Match</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/animations.css">
</head>
<body>

<!-- Feature 6: Skip to content link for accessibility -->
<a href="#boardContainer" class="skip-link">跳到游戏棋盘</a>

<div class="app">

  <!-- ======== TOP HEADER ======== -->
  <header class="top-header" role="banner">
    <span class="logo" aria-label="艾泽拉斯消消乐 Azeroth Match">⚔️ 艾泽拉斯消消乐</span>
    <div class="header-actions">
      <button class="icon-btn" id="soundToggle" aria-label="Toggle sound" role="switch" aria-checked="true">🔊</button>
    </div>
  </header>

  <!-- ======== PAGE: HOME ======== -->
  <main class="page active" id="page-home" role="main" aria-label="Home page">
    <div class="home-hero">
      <div class="hero-emoji">⚔️</div>
      <h2>艾泽拉斯消消乐</h2>
      <p class="subtitle">为了艾泽拉斯！</p>
    </div>

    <div class="home-stats">
      <div class="stat-card">
        <div class="stat-icon">⭐</div>
        <div class="stat-val" id="homeStars">0</div>
        <div class="stat-lbl">星星</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">🗺️</div>
        <div class="stat-val" id="homeLevels">0</div>
        <div class="stat-lbl">通关</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">🔥</div>
        <div class="stat-val" id="homeStreak">0</div>
        <div class="stat-lbl">连续</div>
      </div>
    </div>

    <div class="home-actions">
      <div class="action-card" id="continueCard" onclick="App.navigateTo('adventure')" role="button" tabindex="0" aria-label="Continue campaign">
        <span class="action-icon" aria-hidden="true">⚔️</span>
        <div class="action-info">
          <span class="action-title">继续征程</span>
          <span class="action-desc">艾尔文森林 — 第1关</span>
        </div>
        <span class="action-arrow" aria-hidden="true">›</span>
      </div>

      <div class="action-card" id="dailyChallengeCard" onclick="App.startDailyChallenge()" role="button" tabindex="0" aria-label="Daily challenge">
        <span class="action-icon" aria-hidden="true">📅</span>
        <div class="action-info">
          <span class="action-title">世界任务</span>
          <span class="action-desc">🎯 今日任务等你来！</span>
        </div>
        <span class="action-arrow" aria-hidden="true">›</span>
      </div>

      <div class="action-card" id="timeAttackCard" onclick="App.startTimeAttack()" role="button" tabindex="0" aria-label="Time attack arena">
        <span class="action-icon" aria-hidden="true">⏱️</span>
        <div class="action-info">
          <span class="action-title">竞技场</span>
          <span class="action-desc">⚡ 60秒内冲高分！</span>
        </div>
        <span class="action-arrow" aria-hidden="true">›</span>
      </div>

      <div class="action-card" onclick="App.navigateTo('garden')" role="button" tabindex="0" aria-label="Garrison farm">
        <span class="action-icon" aria-hidden="true">🌿</span>
        <div class="action-info">
          <span class="action-title">要塞农场</span>
          <span class="action-desc">采药、种植、培育</span>
        </div>
        <span class="action-arrow" aria-hidden="true">›</span>
      </div>
    </div>

    <div class="home-footer">
      为了艾泽拉斯 <span>For Azeroth!</span> ⚔️
    </div>
  </main>

  <!-- ======== PAGE: ADVENTURE (MAP) ======== -->
  <div class="page" id="page-adventure" aria-label="Adventure campaign">
    <h3 style="padding:8px 0;font-weight:700;">🗺️ 艾泽拉斯战役</h3>
    <div id="islandList" class="island-list"></div>
  </div>

  <!-- ======== PAGE: GAME ======== -->
  <div class="page" id="page-game" aria-label="Game board">
    <div class="game-header">
      <span class="back-btn" id="gameBackBtn" style="font-size:1.3em;cursor:pointer;">← </span>
      <span class="game-level-badge" id="gameLevelBadge">🌳 1</span>
      <span class="game-moves" id="gameMoves">步数: 25</span>
    </div>

    <div class="game-stats" role="status" aria-live="polite" aria-label="Game statistics">
      <div class="game-stat">
        <div class="gs-label">能量</div>
        <div class="gs-value" id="gameScore" aria-label="Score">0</div>
      </div>
      <div class="game-stat">
        <div class="gs-label">目标</div>
        <div class="gs-value" id="gameTarget" aria-label="Target score">500</div>
      </div>
      <div class="game-stat">
        <div class="gs-label">连击</div>
        <div class="gs-value" id="gameCombo" aria-label="Combo count">0</div>
      </div>
    </div>

    <div class="game-progress">
      <div class="game-progress-bar" id="gameProgressBar" style="width:0%"></div>
      <div class="game-progress-text" id="gameProgressText">0 / 500</div>
    </div>

    <div id="boardContainer" role="application" aria-label="Match-3 game board">
      <canvas id="gameCanvas" tabindex="0" aria-label="Game board. Select gems to swap and match 3 or more."></canvas>
    </div>

    <div class="game-potions" role="toolbar" aria-label="Potions">
      <button class="potion-btn" id="potionBtn_mana" title="法力药水" aria-label="Mana potion: reshuffle board">
        💧<span class="potion-count" aria-hidden="true">0</span>
      </button>
      <button class="potion-btn" id="potionBtn_frost" title="冰霜药剂" aria-label="Frost potion: add time">
        ❄️<span class="potion-count" aria-hidden="true">0</span>
      </button>
      <button class="potion-btn" id="potionBtn_fire" title="烈焰药剂" aria-label="Fire potion: bomb center">
        💥<span class="potion-count" aria-hidden="true">0</span>
      </button>
      <button class="potion-btn" id="potionBtn_arcane" title="奥术精华药剂" aria-label="Arcane potion: clear all of one color">
        🌈<span class="potion-count" aria-hidden="true">0</span>
      </button>
    </div>
  </div>

  <!-- ======== PAGE: GARDEN ======== -->
  <div class="page" id="page-garden" aria-label="Garrison farm">
    <div id="gardenContainer"></div>
  </div>

  <!-- ======== PAGE: STORY ======== -->
  <div class="page" id="page-story" aria-label="Chronicle">
    <div id="storyContainer"></div>
  </div>

  <!-- ======== PAGE: POTION ======== -->
  <div class="page" id="page-potion" aria-label="Alchemy workshop">
    <h3 style="padding:8px 0;font-weight:700;">⚗️ 炼金工坊</h3>
    <div id="potionContainer"></div>
  </div>

  <!-- ======== PAGE: ACHIEVEMENTS ======== -->
  <div class="page" id="page-achievement" aria-label="Achievements">
    <div id="achievementContainer"></div>
  </div>

</div>

<!-- ======== BOTTOM NAVIGATION ======== -->
<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
  <button class="nav-item active" data-page="home" aria-label="Home" aria-current="page">
    <span class="nav-icon" aria-hidden="true">🏠</span>
    主页
  </button>
  <button class="nav-item" data-page="adventure" aria-label="Campaign">
    <span class="nav-icon" aria-hidden="true">⚔️</span>
    战役
  </button>
  <button class="nav-item" data-page="story" aria-label="Chronicle">
    <span class="nav-icon" aria-hidden="true">📖</span>
    编年史
  </button>
  <button class="nav-item" data-page="garden" aria-label="Farm">
    <span class="nav-icon" aria-hidden="true">🌿</span>
    农场
  </button>
  <button class="nav-item" data-page="achievement" aria-label="Achievements">
    <span class="nav-icon" aria-hidden="true">🏆</span>
    成就
  </button>
</nav>

<!-- ======== MODALS ======== -->

<!-- Level Complete -->
<div class="modal-overlay" id="completeModal" role="dialog" aria-modal="true" aria-labelledby="completeTitle">
  <div class="modal-content">
    <div class="modal-emoji" id="completeEmoji" aria-hidden="true">⚔️</div>
    <div class="modal-title" id="completeTitle">胜利！</div>
    <div class="modal-stars" id="completeStars">⭐⭐⭐</div>
    <p class="modal-text" id="completeText">任务完成！</p>
    <p class="modal-text text-accent" id="completeSeedInfo">🌿 获得草药种子！</p>
    <div class="modal-buttons">
      <button class="btn btn-primary" id="nextLevelBtn">下一关 →</button>
      <button class="btn btn-secondary" onclick="App.hideModal('completeModal'); App.navigateTo('home');">主页</button>
    </div>
  </div>
</div>

<!-- Level Fail -->
<div class="modal-overlay" id="failModal" role="dialog" aria-modal="true" aria-label="Level failed">
  <div class="modal-content">
    <div class="modal-emoji" aria-hidden="true">💪</div>
    <div class="modal-title">差一点！</div>
    <p class="modal-text">勇者不会放弃，再来一次！</p>
    <div class="modal-buttons">
      <button class="btn btn-primary" id="retryBtn">再战一次 ⚔️</button>
      <button class="btn btn-secondary" id="failHomeBtn">主页</button>
    </div>
  </div>
</div>

<!-- Quit Confirmation -->
<div class="modal-overlay" id="quitModal" role="dialog" aria-modal="true" aria-label="Quit confirmation">
  <div class="modal-content">
    <div class="modal-emoji" aria-hidden="true">🤔</div>
    <div class="modal-title">确定撤退？</div>
    <p class="modal-text">当前进度将不会保存</p>
    <div class="modal-buttons">
      <button class="btn btn-danger" onclick="App.hideModal('quitModal'); App.navigateTo('home');">撤退</button>
      <button class="btn btn-secondary" onclick="App.hideModal('quitModal');">继续</button>
    </div>
  </div>
</div>

<!-- Seed Picker -->
<div class="modal-overlay" id="seedModal" role="dialog" aria-modal="true" aria-label="Select seed">
  <div class="modal-content">
    <div class="modal-title">🌰 选择种子</div>
    <div id="seedPickerContent"></div>
    <div class="modal-buttons mt-8">
      <button class="btn btn-secondary" onclick="App.hideModal('seedModal')">取消</button>
    </div>
  </div>
</div>

<!-- Dialogue -->
<div class="modal-overlay" id="dialogueOverlay">
  <div class="dialogue-box" id="dialogueBox">
    <div class="dialogue-portrait" id="dialoguePortrait">⚔️</div>
    <div class="dialogue-speaker" id="dialogueSpeaker">勇者</div>
    <div class="dialogue-text" id="dialogueText">...</div>
    <div class="dialogue-tap">点击继续 ›</div>
  </div>
</div>

<!-- Tutorial -->
<div class="modal-overlay" id="tutorialOverlay" role="dialog" aria-modal="true" aria-label="Tutorial">
  <div class="modal-content">
    <div class="modal-emoji" aria-hidden="true">⚔️</div>
    <div class="modal-title">欢迎来到艾泽拉斯！</div>
    <div class="tutorial-step">
      1️⃣ 点击一个种族棋子选中它<br>
      2️⃣ 再点击相邻的棋子交换位置<br>
      3️⃣ 三个相同种族消除释放战斗力！<br>
      4️⃣ 在步数用完前达到能量目标 ⚡<br>
      5️⃣ 通关后获得草药种子种在农场 🌿
    </div>
    <div class="tutorial-gems" id="tutorialGems"></div>
    <button class="btn btn-primary btn-block" id="startGameBtn">为了艾泽拉斯！⚔️</button>
  </div>
</div>

<!-- ======== SCRIPTS ======== -->
<script src="js/audio.js"></script>
<script src="js/storage.js"></script>
<script src="js/gems.js"></script>
<script src="js/board.js"></script>
<script src="js/campaign.js"></script>
<script src="js/garden.js"></script>
<script src="js/potion.js"></script>
<script src="js/daily.js"></script>
<script src="js/story.js"></script>
<script src="js/app.js"></script>

<!-- Feature 4: PWA Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(reg => {
      console.log('Service Worker registered, scope:', reg.scope);
    }).catch(err => {
      console.log('Service Worker registration failed:', err);
    });
  });
}
</script>

</body>
</html>
